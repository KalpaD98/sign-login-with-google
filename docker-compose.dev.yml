version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    volumes:
      # Mount source code for hot-reload (uvicorn --reload watches Python files)
      - ./backend/app:/app/app
      - ./backend/tests:/app/tests
      # Mount .env file if it exists
      - ./backend/.env:/app/.env:ro
    environment:
      # Override CORS to include localhost:5173 for Vite dev server
      - CORS_ORIGINS=["http://localhost:3000","http://localhost:5173","http://localhost","http://localhost:80"]
    # Remove restart policy for development (easier to stop/start)
    restart: "no"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      # Mount source code for hot-reload (read-write for Vite HMR)
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - ./frontend/index.html:/app/index.html
      - ./frontend/vite.config.js:/app/vite.config.js
      - ./frontend/package.json:/app/package.json
      - ./frontend/package-lock.json:/app/package-lock.json
      # Mount .env file if it exists
      - ./frontend/.env:/app/.env:ro
      # Exclude node_modules from mount (use container's node_modules)
      - /app/node_modules
    ports:
      # Map to 5173 instead of 80 for Vite dev server
      - "5173:5173"
    # Remove restart policy for development
    restart: "no"

